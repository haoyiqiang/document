# TurnBasedEntity

## æ¦‚è¿°
`TurnBasedEntity` æ˜¯å›åˆåˆ¶æ¸¸æˆå®ä½“çš„åŸºç±»ï¼Œç»§æ‰¿è‡ª `Entity` ç±»ã€‚ä¸“é—¨ä¸ºå›åˆåˆ¶æ¸¸æˆè®¾è®¡ï¼Œæä¾›äº†å›åˆç®¡ç†ã€è¡ŒåŠ¨ç‚¹ç³»ç»Ÿã€çŠ¶æ€æ§åˆ¶ç­‰å›åˆåˆ¶ç‰¹æœ‰çš„åŠŸèƒ½ã€‚

**ç»§æ‰¿å…³ç³»ï¼š** `TurnBasedEntity` â†’ `Entity` â†’ `Node2D` â†’ `Node`

## ä¸»è¦ç‰¹æ€§
- â° å›åˆåˆ¶æ—¶é—´ç®¡ç†
- ğŸ¯ è¡ŒåŠ¨ç‚¹ç³»ç»Ÿ
- ğŸ“Š å›åˆçŠ¶æ€æ§åˆ¶
- ğŸ® å›åˆåˆ¶è¾“å…¥å¤„ç†
- ğŸ”„ å›åˆåˆ‡æ¢é€»è¾‘
- ğŸ“‹ è¡ŒåŠ¨é˜Ÿåˆ—ç®¡ç†

## å¯¼å‡ºå±æ€§

### `turnOrder: int = 0`
å›åˆé¡ºåºã€‚

**ç±»å‹ï¼š** `int`  
**é»˜è®¤å€¼ï¼š** `0`  
**è¯´æ˜ï¼š** å†³å®šå®ä½“åœ¨å›åˆä¸­çš„æ‰§è¡Œé¡ºåº

### `actionPoints: int = 3`
è¡ŒåŠ¨ç‚¹æ•°é‡ã€‚

**ç±»å‹ï¼š** `int`  
**é»˜è®¤å€¼ï¼š** `3`  
**è¯´æ˜ï¼š** æ¯å›åˆå¯ç”¨çš„è¡ŒåŠ¨ç‚¹

### `maxActionPoints: int = 3`
æœ€å¤§è¡ŒåŠ¨ç‚¹æ•°é‡ã€‚

**ç±»å‹ï¼š** `int`  
**é»˜è®¤å€¼ï¼š** `3`  
**è¯´æ˜ï¼š** è¡ŒåŠ¨ç‚¹çš„ä¸Šé™

### `isActive: bool = false`
æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚

**ç±»å‹ï¼š** `bool`  
**é»˜è®¤å€¼ï¼š** `false`  
**è¯´æ˜ï¼š** å½“å‰æ˜¯å¦ä¸ºè¯¥å®ä½“çš„å›åˆ

## çŠ¶æ€å±æ€§

### `currentTurn: int = 0`
å½“å‰å›åˆæ•°ã€‚

**ç±»å‹ï¼š** `int`  
**è¯´æ˜ï¼š** è·Ÿè¸ªå½“å‰å›åˆè¿›åº¦

### `pendingActions: Array`
å¾…æ‰§è¡Œè¡ŒåŠ¨é˜Ÿåˆ—ã€‚

**ç±»å‹ï¼š** `Array`  
**è¯´æ˜ï¼š** å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„è¡ŒåŠ¨

## æ ¸å¿ƒæ–¹æ³•

### `_ready() -> void`
å›åˆåˆ¶å®ä½“å‡†å¤‡å°±ç»ªæ—¶è°ƒç”¨ã€‚

**åŠŸèƒ½ï¼š**
1. è°ƒç”¨çˆ¶ç±»çš„ `_ready()` æ–¹æ³•
2. åˆå§‹åŒ–å›åˆåˆ¶ç‰¹å®šåŠŸèƒ½
3. è®¾ç½®å›åˆçŠ¶æ€

### `startTurn() -> void`
å¼€å§‹å®ä½“çš„å›åˆã€‚

**åŠŸèƒ½ï¼š**
1. è®¾ç½®æ´»åŠ¨çŠ¶æ€
2. é‡ç½®è¡ŒåŠ¨ç‚¹
3. å¤„ç†å›åˆå¼€å§‹é€»è¾‘
4. å‘å‡ºå›åˆå¼€å§‹ä¿¡å·

### `endTurn() -> void`
ç»“æŸå®ä½“çš„å›åˆã€‚

**åŠŸèƒ½ï¼š**
1. æ¸…é™¤æ´»åŠ¨çŠ¶æ€
2. å¤„ç†å›åˆç»“æŸé€»è¾‘
3. å‘å‡ºå›åˆç»“æŸä¿¡å·
4. é€šçŸ¥å›åˆç®¡ç†å™¨

### `canTakeAction() -> bool`
æ£€æŸ¥æ˜¯å¦å¯ä»¥æ‰§è¡Œè¡ŒåŠ¨ã€‚

**è¿”å›ï¼š** æ˜¯å¦å¯ä»¥æ‰§è¡Œè¡ŒåŠ¨  
**æ¡ä»¶ï¼š**
- å®ä½“å¤„äºæ´»åŠ¨çŠ¶æ€
- æœ‰è¶³å¤Ÿçš„è¡ŒåŠ¨ç‚¹
- æ²¡æœ‰å…¶ä»–é™åˆ¶

### `spendActionPoints(cost: int) -> bool`
æ¶ˆè€—è¡ŒåŠ¨ç‚¹ã€‚

**å‚æ•°ï¼š** `cost` - æ¶ˆè€—çš„è¡ŒåŠ¨ç‚¹æ•°é‡  
**è¿”å›ï¼š** æ˜¯å¦æˆåŠŸæ¶ˆè€—  
**åŠŸèƒ½ï¼š**
1. æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„è¡ŒåŠ¨ç‚¹
2. æ‰£é™¤è¡ŒåŠ¨ç‚¹
3. æ›´æ–°çŠ¶æ€

### `addAction(action: Dictionary) -> void`
æ·»åŠ è¡ŒåŠ¨åˆ°é˜Ÿåˆ—ã€‚

**å‚æ•°ï¼š** `action` - è¡ŒåŠ¨æ•°æ®  
**åŠŸèƒ½ï¼š**
1. éªŒè¯è¡ŒåŠ¨æœ‰æ•ˆæ€§
2. æ·»åŠ åˆ°å¾…æ‰§è¡Œé˜Ÿåˆ—
3. æ›´æ–°è¡ŒåŠ¨çŠ¶æ€

### `executeActions() -> void`
æ‰§è¡Œæ‰€æœ‰å¾…æ‰§è¡Œè¡ŒåŠ¨ã€‚

**åŠŸèƒ½ï¼š**
1. éå†è¡ŒåŠ¨é˜Ÿåˆ—
2. æ‰§è¡Œæ¯ä¸ªè¡ŒåŠ¨
3. æ¸…ç†å·²æ‰§è¡Œè¡ŒåŠ¨
4. æ›´æ–°å®ä½“çŠ¶æ€

## å›åˆç®¡ç†

### `onTurnStart() -> void`
å›åˆå¼€å§‹æ—¶è°ƒç”¨ã€‚

**åŠŸèƒ½ï¼š** å¤„ç†å›åˆå¼€å§‹æ—¶çš„é€»è¾‘

### `onTurnEnd() -> void`
å›åˆç»“æŸæ—¶è°ƒç”¨ã€‚

**åŠŸèƒ½ï¼š** å¤„ç†å›åˆç»“æŸæ—¶çš„é€»è¾‘

### `onActionExecuted(action: Dictionary) -> void`
è¡ŒåŠ¨æ‰§è¡Œåè°ƒç”¨ã€‚

**å‚æ•°ï¼š** `action` - æ‰§è¡Œçš„è¡ŒåŠ¨æ•°æ®  
**åŠŸèƒ½ï¼š** å¤„ç†è¡ŒåŠ¨æ‰§è¡Œåçš„é€»è¾‘

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€å›åˆåˆ¶å®ä½“åˆ›å»º
```gdscript
# åˆ›å»ºå›åˆåˆ¶å®ä½“
var turnEntity = TurnBasedEntity.new()
turnEntity.turnOrder = 1
turnEntity.actionPoints = 2

# æ·»åŠ åˆ°åœºæ™¯
add_child(turnEntity)
```

### å›åˆç®¡ç†
```gdscript
# å¼€å§‹å›åˆ
turnEntity.startTurn()

# æ£€æŸ¥æ˜¯å¦å¯ä»¥è¡ŒåŠ¨
if turnEntity.canTakeAction():
    # æ‰§è¡Œè¡ŒåŠ¨
    turnEntity.spendActionPoints(1)
    
# ç»“æŸå›åˆ
turnEntity.endTurn()
```

### è¡ŒåŠ¨ç³»ç»Ÿ
```gdscript
# æ·»åŠ è¡ŒåŠ¨åˆ°é˜Ÿåˆ—
var action = {
    "type": "move",
    "target": Vector2(100, 100),
    "cost": 1
}
turnEntity.addAction(action)

# æ‰§è¡Œæ‰€æœ‰è¡ŒåŠ¨
turnEntity.executeActions()
```

## æ³¨æ„äº‹é¡¹

1. **å›åˆé¡ºåº** - ç¡®ä¿æ­£ç¡®è®¾ç½® `turnOrder` ä»¥æ§åˆ¶æ‰§è¡Œé¡ºåº
2. **è¡ŒåŠ¨ç‚¹ç®¡ç†** - åˆç†åˆ†é…å’Œä½¿ç”¨è¡ŒåŠ¨ç‚¹
3. **çŠ¶æ€åŒæ­¥** - ç¡®ä¿å›åˆçŠ¶æ€ä¸æ¸¸æˆçŠ¶æ€åŒæ­¥
4. **è¡ŒåŠ¨éªŒè¯** - åœ¨æ‰§è¡Œè¡ŒåŠ¨å‰éªŒè¯å…¶æœ‰æ•ˆæ€§
5. **æ€§èƒ½è€ƒè™‘** - å›åˆåˆ¶æ¸¸æˆé€šå¸¸éœ€è¦ç²¾ç¡®çš„çŠ¶æ€ç®¡ç†

## ç›¸å…³ç»„ä»¶

- **TurnBasedComponent** - å›åˆåˆ¶åŸºç¡€ç»„ä»¶
- **TurnBasedAnimationComponent** - å›åˆåˆ¶åŠ¨ç”»ç»„ä»¶
- **ActionComponent** - è¡ŒåŠ¨ç®¡ç†ç»„ä»¶
- **StatsComponent** - å±æ€§ç®¡ç†ç»„ä»¶ 