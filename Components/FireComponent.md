# FireComponent

## æ¦‚è¿°
`FireComponent` æ˜¯ä¸€ä¸ªé€šç”¨çš„å‘å°„ç»„ä»¶ï¼Œç»§æ‰¿è‡ª `CooldownComponent`ï¼Œæ”¯æŒä»»ä½•ç±»å‹çš„æ”»å‡»å®ä½“å‘å°„ã€‚é€šè¿‡ `bulletEntity` PackedScene å’Œ `fireMode` é…ç½®ï¼Œå¯ä»¥æ”¯æŒæ¿€å…‰ã€é—ªç”µã€å­å¼¹ç­‰ä»»ä½•æ”»å‡»å®ä½“ç±»å‹ã€‚æ”¯æŒå•ä¸€å®ä½“ï¼ˆSINGLEï¼‰å’Œå¤šå®ä½“ï¼ˆMULTIPLEï¼‰ä¸¤ç§å‘å°„æ¨¡å¼ã€‚

**ç»§æ‰¿å…³ç³»ï¼š** `FireComponent` â†’ `CooldownComponent` â†’ `Component` â†’ `Node`

## ä¸»è¦ç‰¹æ€§
- ğŸ¯ é€šç”¨å‘å°„ç³»ç»Ÿï¼Œæ”¯æŒä»»ä½•ç»§æ‰¿è‡ª Entity çš„æ”»å‡»å®ä½“
- ğŸ”„ åŒå‘å°„æ¨¡å¼ï¼šå•ä¸€å®ä½“å’Œå¤šå®ä½“æ¨¡å¼
- âš¡ è‡ªåŠ¨å°„å‡»æ¨¡å¼æ”¯æŒ
- ğŸ® å¼¹è¯ç³»ç»Ÿé›†æˆ
- ğŸ¨ é˜µè¥ç³»ç»Ÿè‡ªåŠ¨ä¼ é€’
- ğŸ›¡ï¸ ä¼¤å®³ç»„ä»¶è‡ªåŠ¨é…ç½®
- ğŸ§¹ è‡ªåŠ¨æ¸…ç†æ— æ•ˆå®ä½“ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²
- ğŸ“Š å®Œæ•´çš„è°ƒè¯•ä¿¡æ¯è¾“å‡º

## ä¾èµ–èŠ‚ç‚¹
- **Pivot/GunSprite/BulletEmitter: Marker2D** (å­èŠ‚ç‚¹) - å‘å°„ä½ç½®æ ‡è®°

## å‘å°„æ¨¡å¼æšä¸¾

### `FireMode`
```gdscript
enum FireMode {
	SINGLE,         ## å•å‘å°„å‡»æ¨¡å¼ - å®ä½“é”€æ¯ï¼Œæ‰ä¼šåˆ›å»ºæ–°çš„å®ä½“ï¼Œä½¿ç”¨åœºæ™¯ï¼šä¸€æ¬¡æ€§ç®­çŸ¢
	MULTIPLE,       ## è¿å‘å°„å‡»æ¨¡å¼ - å…è®¸å¤šä¸ªå®ä½“åŒæ—¶å­˜åœ¨ï¼Œä½¿ç”¨åœºæ™¯ï¼šè¿å‘å°„å‡»å­å¼¹
}
```

## å¯¼å‡ºå±æ€§

### `fireMode: FireMode = FireMode.SINGLE`
å‘å°„æ¨¡å¼é…ç½®ã€‚

**ç±»å‹ï¼š** `FireMode`  
**é»˜è®¤å€¼ï¼š** `FireMode.SINGLE`  
**è¯´æ˜ï¼š** æ§åˆ¶å‘å°„è¡Œä¸ºæ¨¡å¼ï¼Œå½±å“å®ä½“ç”Ÿå‘½å‘¨æœŸç®¡ç†

### `bulletEntity: PackedScene`
æ”»å‡»å®ä½“åœºæ™¯èµ„æºã€‚

**ç±»å‹ï¼š** `PackedScene`  
**é»˜è®¤å€¼ï¼š** `null`  
**è¦æ±‚ï¼š** å¿…é¡»ç»§æ‰¿è‡ª `Entity` ç±»  
**ç”¨é€”ï¼š** å®šä¹‰è¦å‘å°„çš„æ”»å‡»å®ä½“ç±»å‹

### `bulletConfig: EntityConfig`
æ”»å‡»å®ä½“é…ç½®èµ„æºã€‚

**ç±»å‹ï¼š** `EntityConfig`  
**é»˜è®¤å€¼ï¼š** `null`  
**ç”¨é€”ï¼š** ç”¨äºè®¾ç½®å®ä½“çš„ export å±æ€§ï¼Œé…ç½®å®ä½“è¡Œä¸º

### `ammo: Stat`
å¼¹è¯ç»Ÿè®¡èµ„æºï¼ˆå¯é€‰ï¼‰ã€‚

**ç±»å‹ï¼š** `Stat`  
**é»˜è®¤å€¼ï¼š** `null`  
**ç”¨é€”ï¼š** ç®¡ç†å¼¹è¯æ•°é‡ï¼Œæ”¯æŒå¼¹è¯æ¶ˆè€—æœºåˆ¶

### `ammoCost: int = 0`
æ¯æ¬¡å°„å‡»æ¶ˆè€—çš„å¼¹è¯æ•°é‡ã€‚

**ç±»å‹ï¼š** `int`  
**é»˜è®¤å€¼ï¼š** `0`  
**è¯´æ˜ï¼š** å½“ `ammo` é…ç½®æ—¶ï¼Œæ¯æ¬¡å‘å°„ä¼šæ¶ˆè€—æŒ‡å®šæ•°é‡çš„å¼¹è¯

### `ammoDepletedMessage: String = "AMMO DEPLETED"`
å¼¹è¯è€—å°½æ—¶æ˜¾ç¤ºçš„æ¶ˆæ¯ã€‚

**ç±»å‹ï¼š** `String`  
**é»˜è®¤å€¼ï¼š** `"AMMO DEPLETED"`  
**ç”¨é€”ï¼š** å½“å¼¹è¯è€—å°½æ—¶é€šè¿‡ `LabelComponent` æ˜¾ç¤ºæç¤ºä¿¡æ¯

### `isEnabled: bool = true`
æ˜¯å¦å¯ç”¨ç»„ä»¶ã€‚

**ç±»å‹ï¼š** `bool`  
**é»˜è®¤å€¼ï¼š** `true`  
**ç”¨é€”ï¼š** æ§åˆ¶ç»„ä»¶æ˜¯å¦å“åº”å‘å°„è¯·æ±‚

### `autoFire: bool = false`
è‡ªåŠ¨å°„å‡»æ¨¡å¼ã€‚

**ç±»å‹ï¼š** `bool`  
**é»˜è®¤å€¼ï¼š** `false`  
**è¯´æ˜ï¼š** å¯ç”¨åä¼šåœ¨ `_process()` ä¸­è‡ªåŠ¨è°ƒç”¨ `fire()` æ–¹æ³•

## çŠ¶æ€å±æ€§

### `bulletEntityList: Array[Entity]`
æ”»å‡»å®ä½“åˆ—è¡¨ã€‚

**ç±»å‹ï¼š** `Array[Entity]`  
**ç”¨é€”ï¼š** ç»´æŠ¤æ‰€æœ‰å½“å‰å­˜åœ¨çš„æ”»å‡»å®ä½“ï¼Œç”¨äºç”Ÿå‘½å‘¨æœŸç®¡ç†

### `fireEmitter: Marker2D`
å‘å°„ä½ç½®èŠ‚ç‚¹å¼•ç”¨ã€‚

**ç±»å‹ï¼š** `Marker2D`  
**è·å–ï¼š** `@onready var fireEmitter: Marker2D = $Pivot/GunSprite/BulletEmitter`  
**ç”¨é€”ï¼š** å®šä¹‰æ”»å‡»å®ä½“çš„å‘å°„ä½ç½®

## ä¾èµ–ç»„ä»¶

### `labelComponent: LabelComponent`
æ ‡ç­¾ç»„ä»¶å¼•ç”¨ï¼Œç”¨äºæ˜¾ç¤ºå¼¹è¯è€—å°½æ¶ˆæ¯ã€‚

**è·å–ï¼š** é€šè¿‡ `coComponents.get(&"LabelComponent")` è·å–  
**ç”¨é€”ï¼š** æ˜¾ç¤ºå¼¹è¯ç›¸å…³çš„æç¤ºä¿¡æ¯

## ä¿¡å·

### `fireStarted(entity: Entity)`
å‘å°„å¼€å§‹ä¿¡å·ã€‚

**å‚æ•°ï¼š** `entity` - åˆšåˆ›å»ºçš„æ”»å‡»å®ä½“  
**æ—¶æœºï¼š** æ”»å‡»å®ä½“è¿›å…¥åœºæ™¯æ ‘æ—¶å‘å‡º

### `fireCompleted(entity: Entity)`
å‘å°„å®Œæˆä¿¡å·ã€‚

**å‚æ•°ï¼š** `entity` - å·²é”€æ¯çš„æ”»å‡»å®ä½“  
**æ—¶æœºï¼š** æ”»å‡»å®ä½“ç¦»å¼€åœºæ™¯æ ‘æ—¶å‘å‡º

### `didDepleteAmmo`
å¼¹è¯è€—å°½ä¿¡å·ã€‚

**æ—¶æœºï¼š** å¼¹è¯ä»å¤§äº0å˜ä¸º0æˆ–ä»¥ä¸‹æ—¶å‘å‡º

### `ammoInsufficient`
å¼¹è¯ä¸è¶³ä¿¡å·ã€‚

**æ—¶æœºï¼š** å°è¯•å‘å°„ä½†å¼¹è¯ä¸è¶³æ—¶å‘å‡º

## æ ¸å¿ƒæ–¹æ³•

### `fire(config: EntityConfig = bulletConfig) -> Entity`
å¼€å§‹å‘å°„æ”»å‡»ã€‚

**å‚æ•°ï¼š** `config` - å¯é€‰çš„å®ä½“é…ç½®ï¼Œé»˜è®¤ä½¿ç”¨ `bulletConfig`  
**è¿”å›ï¼š** åˆ›å»ºçš„å®ä½“å®ä¾‹ï¼Œå¤±è´¥æ—¶è¿”å› `null`  
**åŠŸèƒ½ï¼š**
1. æ¸…ç†æ— æ•ˆå®ä½“
2. éªŒè¯å‘å°„æ¡ä»¶
3. åˆ›å»ºå¹¶é…ç½®æ”»å‡»å®ä½“
4. å¯åŠ¨å†·å´è®¡æ—¶
5. è¿”å›åˆ›å»ºçš„å®ä½“

### `createEntity(config: EntityConfig) -> Entity`
åˆ›å»ºæ”»å‡»å®ä½“ï¼ˆè™šæ‹Ÿæ–¹æ³•ï¼Œå¯è¢«å­ç±»é‡å†™ï¼‰ã€‚

**å‚æ•°ï¼š** `config` - å®ä½“é…ç½®  
**è¿”å›ï¼š** åˆ›å»ºçš„å®ä½“å®ä¾‹  
**åŠŸèƒ½ï¼š**
1. æ£€æŸ¥å¼¹è¯æ¶ˆè€—
2. æ ¹æ®å‘å°„æ¨¡å¼å†³å®šæ˜¯å¦åˆ›å»ºæ–°å®ä½“
3. å®ä¾‹åŒ–å®ä½“
4. é…ç½®å¹¶æ·»åŠ åˆ°åœºæ™¯
5. è¿”å›å®ä½“å®ä¾‹

### `configureEntity(entity: Entity, config: EntityConfig) -> void`
é…ç½®æ”»å‡»å®ä½“ï¼ˆè™šæ‹Ÿæ–¹æ³•ï¼Œå¯è¢«å­ç±»é‡å†™ï¼‰ã€‚

**å‚æ•°ï¼š** 
- `entity` - è¦é…ç½®çš„å®ä½“
- `config` - é…ç½®èµ„æº

**åŠŸèƒ½ï¼š**
1. åº”ç”¨é…ç½®èµ„æºåˆ°å®ä½“
2. è®¾ç½®è°ƒè¯•æ ‡å¿—
3. è¿æ¥ç”Ÿå‘½å‘¨æœŸä¿¡å·
4. é…ç½®ä¼¤å®³ç»„ä»¶
5. ä¼ é€’é˜µè¥ä¿¡æ¯

### `addEntityToScene(entity: Entity) -> void`
å°†æ”»å‡»å®ä½“æ·»åŠ åˆ°åœºæ™¯ã€‚

**å‚æ•°ï¼š** `entity` - è¦æ·»åŠ çš„å®ä½“  
**åŠŸèƒ½ï¼š** å°†å®ä½“æ·»åŠ ä¸º `fireEmitter` çš„å­èŠ‚ç‚¹

### `cleanupInvalidEntities() -> void`
æ¸…ç†æ— æ•ˆçš„å®ä½“ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²ã€‚

**åŠŸèƒ½ï¼š**
1. éå† `bulletEntityList`
2. æ£€æŸ¥å®ä½“æœ‰æ•ˆæ€§
3. ç§»é™¤æ— æ•ˆå®ä½“
4. è¾“å‡ºæ¸…ç†ç»Ÿè®¡ä¿¡æ¯

### `useAmmo() -> bool`
ä½¿ç”¨å¼¹è¯ã€‚

**è¿”å›ï¼š** æ˜¯å¦æˆåŠŸæ¶ˆè€—å¼¹è¯  
**åŠŸèƒ½ï¼š**
1. æ£€æŸ¥æ˜¯å¦éœ€è¦æ¶ˆè€—å¼¹è¯
2. éªŒè¯å¼¹è¯æ˜¯å¦è¶³å¤Ÿ
3. æ‰£é™¤å¼¹è¯æ•°é‡
4. æ£€æŸ¥æ˜¯å¦è€—å°½å¼¹è¯
5. å‘å‡ºç›¸åº”ä¿¡å·

## å…¬å…±æ¥å£

### `canFire() -> bool`
æ£€æŸ¥æ˜¯å¦å¯ä»¥å‘å°„ã€‚

**è¿”å›ï¼š** æ˜¯å¦å¯ä»¥å‘å°„  
**æ¡ä»¶ï¼š** ç»„ä»¶å¯ç”¨ä¸”å†·å´å·²å®Œæˆ

### `getCurrentFireMode() -> FireMode`
è·å–å½“å‰å‘å°„æ¨¡å¼ã€‚

**è¿”å›ï¼š** å½“å‰çš„å‘å°„æ¨¡å¼æšä¸¾å€¼

### `getFireModeName() -> String`
è·å–å‘å°„æ¨¡å¼åç§°ï¼ˆç”¨äºè°ƒè¯•ï¼‰ã€‚

**è¿”å›ï¼š** å‘å°„æ¨¡å¼çš„å­—ç¬¦ä¸²è¡¨ç¤º

## é…ç½®éªŒè¯

### `validateFireModeConfiguration() -> bool`
éªŒè¯å‘å°„æ¨¡å¼é…ç½®ã€‚

**è¿”å›ï¼š** é…ç½®æ˜¯å¦æœ‰æ•ˆ  
**åŠŸèƒ½ï¼š**
1. æ£€æŸ¥å‘å°„æ¨¡å¼æœ‰æ•ˆæ€§
2. éªŒè¯æ”»å‡»å®ä½“é…ç½®
3. æ ¹æ®æ¨¡å¼æä¾›å»ºè®®é…ç½®
4. è¾“å‡ºéªŒè¯ç»“æœ

## è°ƒè¯•åŠŸèƒ½

### `printFireDebugInfo() -> void`
è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚

**åŠŸèƒ½ï¼š**
1. æ˜¾ç¤ºå‘å°„æ¨¡å¼ä¿¡æ¯
2. æ˜¾ç¤ºå†·å´çŠ¶æ€
3. åˆ—å‡ºæ‰€æœ‰æ”»å‡»å®ä½“çŠ¶æ€
4. æ˜¾ç¤ºå¼¹è¯ä¿¡æ¯ï¼ˆå¦‚æœé…ç½®ï¼‰

## ä¿¡å·å¤„ç†

### `_on_bullet_entity_tree_entered(node: Node) -> void`
æ”»å‡»å®ä½“è¿›å…¥åœºæ™¯æ ‘æ—¶è°ƒç”¨ã€‚

**å‚æ•°ï¼š** `node` - è¿›å…¥åœºæ™¯æ ‘çš„èŠ‚ç‚¹  
**åŠŸèƒ½ï¼š**
1. éªŒè¯èŠ‚ç‚¹ç±»å‹
2. å‘å‡º `fireStarted` ä¿¡å·
3. æ·»åŠ åˆ°å®ä½“åˆ—è¡¨

### `_on_bullet_entity_ready(entity: Entity) -> void`
æ”»å‡»å®ä½“å‡†å¤‡å¥½æ—¶è°ƒç”¨ã€‚

**å‚æ•°ï¼š** `entity` - å‡†å¤‡å¥½çš„å®ä½“  
**åŠŸèƒ½ï¼š** è¾“å‡ºè°ƒè¯•ä¿¡æ¯

### `_on_bullet_entity_tree_exited(node: Node) -> void`
æ”»å‡»å®ä½“ç¦»å¼€åœºæ™¯æ ‘æ—¶è°ƒç”¨ã€‚

**å‚æ•°ï¼š** `node` - ç¦»å¼€åœºæ™¯æ ‘çš„èŠ‚ç‚¹  
**åŠŸèƒ½ï¼š**
1. éªŒè¯èŠ‚ç‚¹ç±»å‹
2. å‘å‡º `fireCompleted` ä¿¡å·
3. ä»å®ä½“åˆ—è¡¨ç§»é™¤

### `_on_entity_tree_exiting(entity: Entity) -> void`
å®ä½“å³å°†ç¦»å¼€åœºæ™¯æ ‘æ—¶çš„å¤‡ç”¨æ¸…ç†æœºåˆ¶ã€‚

**å‚æ•°ï¼š** `entity` - å³å°†ç¦»å¼€çš„å®ä½“  
**åŠŸèƒ½ï¼š** ç¡®ä¿å®ä½“ä»åˆ—è¡¨ä¸­ç§»é™¤

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€é…ç½®
```gdscript
# é…ç½®å•ä¸€å‘å°„æ¨¡å¼
var fireComponent = FireComponent.new()
fireComponent.fireMode = FireComponent.FireMode.SINGLE
fireComponent.bulletEntity = preload("res://Entities/Bullet.tscn")
fireComponent.cooldown = 1.0
```

### å¤šå‘å°„æ¨¡å¼é…ç½®
```gdscript
# é…ç½®è¿å‘å°„å‡»æ¨¡å¼
var fireComponent = FireComponent.new()
fireComponent.fireMode = FireComponent.FireMode.MULTIPLE
fireComponent.bulletEntity = preload("res://Entities/Laser.tscn")
fireComponent.cooldown = 0.2
```

### å¼¹è¯ç³»ç»Ÿé›†æˆ
```gdscript
# é…ç½®å¼¹è¯æ¶ˆè€—
var fireComponent = FireComponent.new()
fireComponent.ammo = ammoStat
fireComponent.ammoCost = 1
fireComponent.ammoDepletedMessage = "å¼¹è¯è€—å°½ï¼"
```

### è‡ªåŠ¨å°„å‡»
```gdscript
# å¯ç”¨è‡ªåŠ¨å°„å‡»
var fireComponent = FireComponent.new()
fireComponent.autoFire = true
fireComponent.cooldown = 0.5
```

## æ³¨æ„äº‹é¡¹

1. **å†…å­˜ç®¡ç†ï¼š** ç»„ä»¶ä¼šè‡ªåŠ¨æ¸…ç†æ— æ•ˆå®ä½“ï¼Œä½†å»ºè®®å®šæœŸè°ƒç”¨ `cleanupInvalidEntities()`
2. **å‘å°„æ¨¡å¼é€‰æ‹©ï¼š** 
   - `SINGLE` æ¨¡å¼é€‚åˆä¸€æ¬¡æ€§æ”»å‡»ï¼ˆå¦‚ç®­çŸ¢ï¼‰
   - `MULTIPLE` æ¨¡å¼é€‚åˆè¿å‘å°„å‡»ï¼ˆå¦‚æœºå…³æªï¼‰
3. **å¼¹è¯ç³»ç»Ÿï¼š** éœ€è¦é…ç½® `ammo` å’Œ `ammoCost` æ‰èƒ½å¯ç”¨å¼¹è¯æ¶ˆè€—
4. **é˜µè¥ä¼ é€’ï¼š** ä¼šè‡ªåŠ¨å°†çˆ¶å®ä½“çš„é˜µè¥ä¿¡æ¯ä¼ é€’ç»™æ”»å‡»å®ä½“
5. **ä¼¤å®³ç»„ä»¶ï¼š** ä¼šè‡ªåŠ¨è®¾ç½®æ”»å‡»å®ä½“çš„ä¼¤å®³ç»„ä»¶å‘èµ·è€…
6. **è°ƒè¯•æ¨¡å¼ï¼š** å¯ç”¨ `debugMode` å¯æŸ¥çœ‹è¯¦ç»†çš„å‘å°„ä¿¡æ¯

## ç»§æ‰¿æ‰©å±•

`FireComponent` è®¾è®¡ä¸ºå¯æ‰©å±•çš„åŸºç±»ï¼Œå­ç±»å¯ä»¥é‡å†™ä»¥ä¸‹æ–¹æ³•æ¥è‡ªå®šä¹‰è¡Œä¸ºï¼š

- `createEntity()` - è‡ªå®šä¹‰å®ä½“åˆ›å»ºé€»è¾‘
- `configureEntity()` - è‡ªå®šä¹‰å®ä½“é…ç½®é€»è¾‘
- `addEntityToScene()` - è‡ªå®šä¹‰åœºæ™¯æ·»åŠ é€»è¾‘

## ç›¸å…³ç»„ä»¶

- **CooldownComponent** - æä¾›å†·å´æ—¶é—´ç®¡ç†
- **DamageComponent** - ä¼¤å®³ç³»ç»Ÿé›†æˆ
- **FactionComponent** - é˜µè¥ç³»ç»Ÿé›†æˆ
- **LabelComponent** - æ¶ˆæ¯æ˜¾ç¤ºæ”¯æŒ 